{"ast":null,"code":"import { doc, getDoc, setDoc } from 'firebase/firestore';\nimport { db } from './config';\n\n// –î–æ–∫—É–º–µ–Ω—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ Telegram\nconst telegramConfigDoc = doc(db, 'telegramConfig');\n\n// –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Telegram\nexport const getTelegramConfig = async () => {\n  try {\n    const docSnap = await getDoc(telegramConfigDoc);\n    if (docSnap.exists()) {\n      return docSnap.data();\n    } else {\n      // –°–æ–∑–¥–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç\n      const defaultConfig = {\n        botToken: '',\n        channelId: '',\n        enabled: false\n      };\n      await setDoc(telegramConfigDoc, defaultConfig);\n      return defaultConfig;\n    }\n  } catch (error) {\n    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Telegram:', error);\n    throw error;\n  }\n};\n\n// –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Telegram\nexport const updateTelegramConfig = async configData => {\n  try {\n    await setDoc(telegramConfigDoc, configData);\n    return configData;\n  } catch (error) {\n    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Telegram:', error);\n    throw error;\n  }\n};\n\n// –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram –∫–∞–Ω–∞–ª\nexport const sendTelegramMessage = async message => {\n  try {\n    const config = await getTelegramConfig();\n    if (!config.enabled || !config.botToken || !config.channelId) {\n      console.warn('Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞ –∏–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞');\n      return false;\n    }\n\n    // –ò—Å–ø–æ–ª—å–∑—É–µ–º Telegram Bot API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è\n    const url = `https://api.telegram.org/bot${config.botToken}/sendMessage`;\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        chat_id: config.channelId,\n        text: message,\n        parse_mode: 'HTML'\n      })\n    });\n    const data = await response.json();\n    if (!data.ok) {\n      throw new Error(`–û—à–∏–±–∫–∞ Telegram API: ${data.description}`);\n    }\n    return true;\n  } catch (error) {\n    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram:', error);\n    throw error;\n  }\n};\n\n// –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º –ª—É—á—à–µ–º –ø—Ä–æ–º–æ—É—Ç–µ—Ä–µ\nexport const sendTopPromoterMessage = async promoter => {\n  if (!promoter) return false;\n  const message = `\nüèÜ <b>–õ—É—á—à–∏–π –ø—Ä–æ–º–æ—É—Ç–µ—Ä –º–µ—Å—è—Ü–∞!</b> üèÜ\n\n–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º <b>${promoter.name}</b> —Å –ø–æ–±–µ–¥–æ–π!\n–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑–Ω–µ—Å–µ–Ω–Ω—ã—Ö –ª–∏—Å—Ç–æ–≤–æ–∫: <b>${promoter.leafletsCount}</b>\n–ù–∞–≥—Ä–∞–¥–∞: <b>${promoter.reward}</b>\n\nüéâ –¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å! üéâ\n  `;\n  return sendTelegramMessage(message);\n};\n\n/*\r\n–ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ù–ê–°–¢–†–û–ô–ö–ï TELEGRAM –ë–û–¢–ê:\r\n\r\n1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather –≤ Telegram\r\n2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (botToken)\r\n3. –°–æ–∑–¥–∞–π—Ç–µ –∫–∞–Ω–∞–ª –≤ Telegram –∏ –¥–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\r\n4. –ü–æ–ª—É—á–∏—Ç–µ ID –∫–∞–Ω–∞–ª–∞ (channelId) - –æ–±—ã—á–Ω–æ —ç—Ç–æ @–∏–º—è_–∫–∞–Ω–∞–ª–∞ –∏–ª–∏ —á–∏—Å–ª–æ–≤–æ–π ID\r\n5. –í–∫–ª—é—á–∏—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (enabled: true)\r\n6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É, –æ—Ç–ø—Ä–∞–≤–∏–≤ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\r\n\r\n–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –î–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram Bot API –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è \r\n–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—É—é —á–∞—Å—Ç—å (Node.js), —á—Ç–æ–±—ã –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ \r\n–Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ. –í –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –º—ã —Ö—Ä–∞–Ω–∏–º —Ç–æ–∫–µ–Ω –≤ Firestore,\r\n–Ω–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Cloud Functions.\r\n*/","map":{"version":3,"names":["doc","getDoc","setDoc","db","telegramConfigDoc","getTelegramConfig","docSnap","exists","data","defaultConfig","botToken","channelId","enabled","error","console","updateTelegramConfig","configData","sendTelegramMessage","message","config","warn","url","response","fetch","method","headers","body","JSON","stringify","chat_id","text","parse_mode","json","ok","Error","description","sendTopPromoterMessage","promoter","name","leafletsCount","reward"],"sources":["D:/–ø—Ä–æ–µ–∫—Ç—ã/Promo rating/src/firebase/telegramService.js"],"sourcesContent":["import { doc, getDoc, setDoc } from 'firebase/firestore';\r\nimport { db } from './config';\r\n\r\n// –î–æ–∫—É–º–µ–Ω—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ Telegram\r\nconst telegramConfigDoc = doc(db, 'telegramConfig');\r\n\r\n// –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Telegram\r\nexport const getTelegramConfig = async () => {\r\n  try {\r\n    const docSnap = await getDoc(telegramConfigDoc);\r\n    \r\n    if (docSnap.exists()) {\r\n      return docSnap.data();\r\n    } else {\r\n      // –°–æ–∑–¥–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç\r\n      const defaultConfig = {\r\n        botToken: '',\r\n        channelId: '',\r\n        enabled: false\r\n      };\r\n      \r\n      await setDoc(telegramConfigDoc, defaultConfig);\r\n      return defaultConfig;\r\n    }\r\n  } catch (error) {\r\n    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Telegram:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Telegram\r\nexport const updateTelegramConfig = async (configData) => {\r\n  try {\r\n    await setDoc(telegramConfigDoc, configData);\r\n    return configData;\r\n  } catch (error) {\r\n    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Telegram:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram –∫–∞–Ω–∞–ª\r\nexport const sendTelegramMessage = async (message) => {\r\n  try {\r\n    const config = await getTelegramConfig();\r\n    \r\n    if (!config.enabled || !config.botToken || !config.channelId) {\r\n      console.warn('Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞ –∏–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞');\r\n      return false;\r\n    }\r\n    \r\n    // –ò—Å–ø–æ–ª—å–∑—É–µ–º Telegram Bot API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è\r\n    const url = `https://api.telegram.org/bot${config.botToken}/sendMessage`;\r\n    const response = await fetch(url, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        chat_id: config.channelId,\r\n        text: message,\r\n        parse_mode: 'HTML'\r\n      }),\r\n    });\r\n    \r\n    const data = await response.json();\r\n    \r\n    if (!data.ok) {\r\n      throw new Error(`–û—à–∏–±–∫–∞ Telegram API: ${data.description}`);\r\n    }\r\n    \r\n    return true;\r\n  } catch (error) {\r\n    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º –ª—É—á—à–µ–º –ø—Ä–æ–º–æ—É—Ç–µ—Ä–µ\r\nexport const sendTopPromoterMessage = async (promoter) => {\r\n  if (!promoter) return false;\r\n  \r\n  const message = `\r\nüèÜ <b>–õ—É—á—à–∏–π –ø—Ä–æ–º–æ—É—Ç–µ—Ä –º–µ—Å—è—Ü–∞!</b> üèÜ\r\n\r\n–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º <b>${promoter.name}</b> —Å –ø–æ–±–µ–¥–æ–π!\r\n–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑–Ω–µ—Å–µ–Ω–Ω—ã—Ö –ª–∏—Å—Ç–æ–≤–æ–∫: <b>${promoter.leafletsCount}</b>\r\n–ù–∞–≥—Ä–∞–¥–∞: <b>${promoter.reward}</b>\r\n\r\nüéâ –¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å! üéâ\r\n  `;\r\n  \r\n  return sendTelegramMessage(message);\r\n};\r\n\r\n/*\r\n–ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ù–ê–°–¢–†–û–ô–ö–ï TELEGRAM –ë–û–¢–ê:\r\n\r\n1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather –≤ Telegram\r\n2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (botToken)\r\n3. –°–æ–∑–¥–∞–π—Ç–µ –∫–∞–Ω–∞–ª –≤ Telegram –∏ –¥–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\r\n4. –ü–æ–ª—É—á–∏—Ç–µ ID –∫–∞–Ω–∞–ª–∞ (channelId) - –æ–±—ã—á–Ω–æ —ç—Ç–æ @–∏–º—è_–∫–∞–Ω–∞–ª–∞ –∏–ª–∏ —á–∏—Å–ª–æ–≤–æ–π ID\r\n5. –í–∫–ª—é—á–∏—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (enabled: true)\r\n6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É, –æ—Ç–ø—Ä–∞–≤–∏–≤ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\r\n\r\n–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –î–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram Bot API –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è \r\n–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—É—é —á–∞—Å—Ç—å (Node.js), —á—Ç–æ–±—ã –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ \r\n–Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ. –í –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –º—ã —Ö—Ä–∞–Ω–∏–º —Ç–æ–∫–µ–Ω –≤ Firestore,\r\n–Ω–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Cloud Functions.\r\n*/ "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}